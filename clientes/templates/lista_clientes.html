{% extends 'panel_admin_base.html' %}
{% load static %}

{% block page_title %}Clientes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'clientes/css/clientes.css' %}">
{% endblock %}

{% block content %}
<!-- HEADER CON ANIMACIÓN -->
<div class="page-header-clientes fadeInUp">
    <div class="page-header-info">
        <h1>
            <i class="bi bi-people-fill"></i> Lista de Clientes
        </h1>
        <p>Gestiona los clientes de la floristería.</p>
    </div>

    <div class="page-header-actions">
        <!-- BUSCADOR DESTACADO (CON HOVER Y FOCUS) -->
        <form method="get" class="d-flex" role="search">
            <input name="q" value="{{ query }}"
                   class="form-control form-control-sm"
                   placeholder="Buscar cliente..."
                   style="width: 250px; background: var(--bg-secondary); border: 1.5px solid var(--border-color); color: var(--text-primary); border-radius: 8px; transition: all 0.2s ease;">
            <button type="submit" class="btn btn-sm ms-1"
                    style="background: var(--bg-secondary); border: 1.5px solid var(--border-color); color: var(--text-secondary); border-radius: 8px; padding: 0.25rem 0.75rem; transition: all 0.2s ease;">
                <i class="bi bi-search"></i>
            </button>
        </form>

        <a href="{% url 'clientes:crear_cliente' %}" class="btn-cliente-nuevo">
            <i class="bi bi-plus-lg"></i> Nuevo cliente
        </a>
    </div>
</div>

<!-- ESTILOS PARA EL BUSCADOR -->
<style>
    /* Hover para el input */
    .page-header-actions input.form-control:hover {
        border-color: #BF5486 !important;
    }

    /* Focus para el input */
    .page-header-actions input.form-control:focus {
        border-color: #BF5486 !important;
        box-shadow: 0 0 0 3px rgba(191, 84, 134, 0.18) !important;
        outline: none !important;
        background: var(--bg-card) !important;
    }

    /* Hover para el botón */
    .page-header-actions button.btn:hover {
        background: #BF5486 !important;
        border-color: #BF5486 !important;
        color: white !important;
    }

    /* Modo claro */
    html[data-theme="light"] .page-header-actions input.form-control {
        background: #ffffff !important;
        color: #212529 !important;
        border-color: #dee2e6 !important;
    }

    html[data-theme="light"] .page-header-actions button.btn {
        background: #f8f9fa !important;
        color: #6c757d !important;
        border-color: #dee2e6 !important;
    }

    html[data-theme="light"] .page-header-actions button.btn:hover {
        background: #BF5486 !important;
        color: white !important;
        border-color: #BF5486 !important;
    }
</style>

<!-- ESTADÍSTICAS CON ANIMACIÓN -->
<div class="stats-grid">
    <div class="stat-card fadeInUp" style="animation-delay: 0.1s;">
        <div class="stat-icon stat-icon-primary">
            <i class="bi bi-people"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">{{ clientes|length }}</div>
            <div class="stat-label">Total clientes</div>
        </div>
    </div>
</div>

<!-- TABLA CON ANIMACIÓN -->
<div class="clientes-table-container fadeInUp" style="animation-delay: 0.2s;">
    <div class="table-responsive">
        <table class="clientes-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>DOCUMENTO</th>
                    <th>CLIENTE</th>
                    <th>TELÉFONO</th>
                    <th>CORREO</th>
                    <th>CIUDAD</th>
                    <th>DEPARTAMENTO</th>
                    <th class="text-end">ACCIONES</th>
                </tr>
            </thead>

            <tbody>
                {% for cliente in clientes %}
                <tr class="slideIn">
                    <td class="fw-semibold">{{ cliente.id }}</td>

                    <td>
                        <span class="badge-cliente">
                            {{ cliente.tipo_documento }} {{ cliente.documento }}
                        </span>
                    </td>

                    <td>
                        <div class="cliente-avatar-wrapper">
                            <div class="cliente-avatar-placeholder">
                                {{ cliente.nombre|first|upper }}{{ cliente.apellido|first|upper }}
                            </div>
                            <div class="cliente-info">
                                <strong>{{ cliente.nombre }} {{ cliente.apellido }}</strong>
                            </div>
                        </div>
                    </td>

                    <td>{{ cliente.telefono|default:'—' }}</td>
                    <td>{{ cliente.correo_electronico|default:'—' }}</td>
                    <td>{{ cliente.ciudad|default:'—' }}</td>
                    <td>{{ cliente.departamento|default:'—' }}</td>

                    <td class="text-end">
                        <div class="acciones-cliente-wrapper">
                            <a href="{% url 'clientes:detalle_cliente' cliente.pk %}"
                               class="btn-cliente-action btn-cliente-ver" title="Ver">
                                <i class="bi bi-eye"></i>
                            </a>

                            <a href="{% url 'clientes:editar_cliente' cliente.pk %}"
                               class="btn-cliente-action btn-cliente-editar" title="Editar">
                                <i class="bi bi-pencil"></i>
                            </a>

                            <a href="{% url 'clientes:eliminar_cliente' cliente.pk %}"
                               class="btn-cliente-action btn-cliente-eliminar" title="Eliminar">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="empty-state">
                        <i class="bi bi-people"></i>
                        <p>No hay clientes registrados aún.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- PAGINACIÓN CON ANIMACIÓN -->
{% if is_paginated %}
<nav aria-label="Paginación" class="mt-3 fadeInUp" style="animation-delay: 0.4s;">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">«</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">«</span>
        </li>
        {% endif %}

        {% for num in paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">»</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">»</span>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'clientes/js/clientes.js' %}"></script>
<script src="{% static 'clientes/js/validaciones.js' %}"></script>
{% endblock %}