{% extends 'panel_admin_base.html' %}
{% load static %}

{% block title %}Mi Perfil{% endblock %}

{% block page_title %}Mi Perfil{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'usuarios/css/perfil.css' %}">
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="page-breadcrumb">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="{% url 'core:dashboard' %}">
                    <i class="bi bi-house-door-fill"></i>
                    <span>Inicio</span>
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'usuarios:lista_usuarios' %}">
                    <i class="bi bi-people-fill"></i>
                    <span>Usuarios</span>
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                Mi Perfil
            </li>
        </ol>
    </nav>
</div>

<!-- Toasts -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 99999;">
    <div id="successToast" class="toast align-items-center text-bg-success border-0 shadow-lg" role="alert">
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center">
                <i class="bi bi-check-circle-fill me-2 fs-5"></i>
                <span id="successToastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
    <div id="errorToast" class="toast align-items-center text-bg-danger border-0 shadow-lg" role="alert">
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center">
                <i class="bi bi-x-circle-fill me-2 fs-5"></i>
                <span id="errorToastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

{% if messages %}
<div id="django-messages" style="display:none;">
    {% for message in messages %}
    <div data-message-level="{{ message.tags }}" data-message-text="{{ message }}"></div>
    {% endfor %}
</div>
{% endif %}

<div class="container-fluid py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">

            <!-- Header del Perfil -->
            <div class="profile-header-card">
                <div class="profile-header-content">
                    <div class="profile-avatar-wrapper">
                        {% if user.perfil.foto_perfil %}
                            <img src="{{ user.perfil.foto_perfil.url }}" alt="{{ user.get_full_name }}" class="profile-avatar">
                        {% else %}
                            <div class="profile-avatar-placeholder">
                                <span>{{ user.first_name.0 }}{{ user.last_name.0 }}</span>
                            </div>
                        {% endif %}
                        <div class="profile-status-indicator"></div>
                    </div>

                    <div class="profile-header-info">
                        <h1 class="profile-name">{{ user.get_full_name|default:user.username }}</h1>
                        <p class="profile-username">@{{ user.username }}</p>
                        <div class="profile-badges">
                            {% if user.is_superuser %}
                                <span class="profile-badge badge-admin">
                                    <i class="bi bi-shield-fill-check"></i> Superadministrador
                                </span>
                            {% elif user.is_staff %}
                                <span class="profile-badge badge-staff">
                                    <i class="bi bi-person-badge-fill"></i> Administrador
                                </span>
                            {% else %}
                                <span class="profile-badge badge-user">
                                    <i class="bi bi-person-fill"></i> Usuario
                                </span>
                            {% endif %}
                            <span class="profile-badge badge-active">
                                <i class="bi bi-circle-fill"></i> Activo
                            </span>
                        </div>
                    </div>

                    <div class="profile-header-actions">
                        <a href="{% url 'usuarios:editar_perfil' %}" class="btn-edit-profile">
                            <i class="bi bi-pencil-square"></i>
                            <span>Editar Perfil</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="profile-tabs-card">
                <ul class="nav nav-tabs profile-nav-tabs" id="profileTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab">
                            <i class="bi bi-person-lines-fill"></i>
                            <span>Información Personal</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                            <i class="bi bi-shield-lock-fill"></i>
                            <span>Seguridad</span>
                        </button>
                    </li>
                </ul>

                <div class="tab-content profile-tab-content" id="profileTabsContent">

                    <!-- Tab: Información Personal -->
                    <div class="tab-pane fade show active" id="info" role="tabpanel">
                        <div class="profile-section">
                            <h3 class="section-title">
                                <i class="bi bi-info-circle-fill"></i>
                                Datos Generales
                            </h3>

                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-envelope-fill"></i>
                                            Correo Electrónico
                                        </label>
                                        <div class="info-value">{{ user.email }}</div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-card-text"></i>
                                            Documento
                                        </label>
                                        <div class="info-value">{{ user.documento }}</div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-person-fill"></i>
                                            Nombre Completo
                                        </label>
                                        <div class="info-value">{{ user.first_name }} {{ user.last_name }}</div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-telephone-fill"></i>
                                            Teléfono
                                        </label>
                                        <div class="info-value">{{ user.perfil.telefono|default:"No especificado" }}</div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-calendar-event"></i>
                                            Fecha de Nacimiento
                                        </label>
                                        <div class="info-value">
                                            {% if user.perfil.fecha_nacimiento %}
                                                {{ user.perfil.fecha_nacimiento|date:"d/m/Y" }}
                                            {% else %}
                                                No especificada
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-calendar-check"></i>
                                            Miembro Desde
                                        </label>
                                        <div class="info-value">{{ user.date_joined|date:"d/m/Y" }}</div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-geo-alt-fill"></i>
                                            Dirección
                                        </label>
                                        <div class="info-value">{{ user.perfil.direccion|default:"No especificada" }}</div>
                                    </div>
                                </div>

                                {% if user.perfil.biografia %}
                                <div class="col-12">
                                    <div class="info-item">
                                        <label class="info-label">
                                            <i class="bi bi-file-text-fill"></i>
                                            Biografía
                                        </label>
                                        <div class="info-value">{{ user.perfil.biografia }}</div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Seguridad -->
                    <div class="tab-pane fade" id="security" role="tabpanel">
                        <div class="profile-section">
                            <h3 class="section-title">
                                <i class="bi bi-shield-lock-fill"></i>
                                Configuración de Seguridad
                            </h3>

                            <div class="security-card">
                                <div class="security-icon">
                                    <i class="bi bi-key-fill"></i>
                                </div>
                                <div class="security-content">
                                    <h4 class="security-title">Contraseña</h4>
                                    <p class="security-description">
                                        Mantén tu cuenta segura actualizando tu contraseña regularmente.
                                        Se recomienda usar una combinación de letras, números y símbolos.
                                    </p>
                                    <a href="{% url 'usuarios:password_reset' %}" class="btn btn-warning">
                                        <i class="bi bi-key-fill"></i>
                                        Cambiar Contraseña
                                    </a>
                                </div>
                            </div>

                            <div class="security-info-grid">
                                <div class="security-info-item">
                                    <i class="bi bi-clock-history"></i>
                                    <div>
                                        <strong>Última Actualización</strong>
                                        <p>{{ user.date_joined|date:"d/m/Y H:i" }}</p>
                                    </div>
                                </div>
                                <div class="security-info-item">
                                    <i class="bi bi-shield-check"></i>
                                    <div>
                                        <strong>Estado de la Cuenta</strong>
                                        <p>Verificada y Activa</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'usuarios/js/perfil.js' %}"></script>
{% endblock %}

